<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carimbo Rede Externa</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    .form-container {
      background: white;
      max-width: 700px;
      margin: auto;
      padding: 20px;
      border: 2px solid #222;
      font-family: 'Courier New', monospace;
    }
    h2, h3, h4 {
      text-align: center;
      margin-top: 1em;
      margin-bottom: 0.5em;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      font-family: monospace;
      margin-top: 5px;
      box-sizing: border-box;
    }
    textarea {
      resize: vertical;
    }
    button, .btn-small {
      margin-top: 10px;
      padding: 8px 12px;
      cursor: pointer;
      font-weight: bold;
      background: #222;
      color: white;
      border: none;
      border-radius: 4px;
      user-select: none;
    }
    button:hover, .btn-small:hover {
      background: #555;
    }
    .checkboxes {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .checkboxes label {
      font-weight: normal;
      cursor: pointer;
    }
    .dupla {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .dupla > div {
      flex: 1 1 48%;
    }
    pre {
      margin-top: 20px;
      padding: 15px;
      background: #eee;
      border: 1px solid #ccc;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      line-height: 1.3;
      max-height: 300px;
      overflow-y: auto;
    }
    footer {
      font-size: 0.75em;
      color: #666;
      text-align: center;
      margin-top: 20px;
    }
    /* Botões para TX/RX física */
    .btn-group {
      margin: 5px 0 15px 0;
      text-align: center;
    }
    .btn-group button {
      margin: 2px;
      min-width: 32px;
      font-size: 0.9em;
      border-radius: 3px;
    }
    .section-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 15px;
      margin-bottom: 20px;
    }
    .section-row > div {
      flex: 1 1 48%;
      min-width: 280px;
    }
    @media(max-width: 480px){
      .dupla > div, .section-row > div {
        flex-basis: 100%;
      }
      button, .btn-small {
        width: 100%;
      }
    }
  </style>
</head>
<body>
<div class="form-container">
  <h2>Carimbo Rede Externa</h2>

  <label for="ta">TA:</label>
  <input type="text" id="ta" placeholder="Ex: 344731005" />

  <div class="checkboxes">
    <label><input type="checkbox" id="vivo1" /> VIVO1</label>
    <label><input type="checkbox" id="vivo2" /> VIVO2</label>
  </div>

  <label for="tecnicoSelect">Técnico:</label>
  <select id="tecnicoSelect"></select>
  <input type="text" id="novoTecnico" placeholder="Novo técnico" />
  <button onclick="adicionarTecnico()">Adicionar Técnico</button>

  <h3>Ponta B</h3>

  <label for="siteSelect">Site:</label>
  <select id="siteSelect"></select>
  <input type="text" id="novoSite" placeholder="Novo site Ponta B" />
  <button onclick="adicionarSite()">Adicionar Site Ponta B</button>

  <div class="section-row">
    <div>
      <label for="txFisico">TX: Física</label>
      <input type="text" id="txFisico" readonly />
      <div class="btn-group" id="filaButtonsB"></div>
      <div class="btn-group" id="btButtonsB"></div>
      <div class="btn-group" id="dgoButtonsB"></div>
      <div class="btn-group" id="fibraButtonsB"></div>
    </div>
    <div>
      <label for="rxFisico">RX: Física</label>
      <input type="text" id="rxFisico" readonly />
      <div class="btn-group" id="filaButtonsRxB"></div>
      <div class="btn-group" id="btButtonsRxB"></div>
      <div class="btn-group" id="dgoButtonsRxB"></div>
      <div class="btn-group" id="fibraButtonsRxB"></div>
    </div>
  </div>

  <div class="dupla">
    <div><label for="txPotencia">TX: Potência</label><input type="text" id="txPotencia" /></div>
    <div><label for="rxPotencia">RX: Potência</label><input type="text" id="rxPotencia" /></div>
  </div>

  <h3>Ponta A</h3>

  <label for="siteSelectA">Site:</label>
  <select id="siteSelectA"></select>
  <input type="text" id="novoSiteA" placeholder="Novo site Ponta A" />
  <button onclick="adicionarSiteA()">Adicionar Site Ponta A</button>

  <div class="section-row">
    <div>
      <label for="txFisicoA">TX: Física</label>
      <input type="text" id="txFisicoA" readonly />
      <div class="btn-group" id="filaButtonsA"></div>
      <div class="btn-group" id="btButtonsA"></div>
      <div class="btn-group" id="dgoButtonsA"></div>
      <div class="btn-group" id="fibraButtonsA"></div>
    </div>
    <div>
      <label for="rxFisicoA">RX: Física</label>
      <input type="text" id="rxFisicoA" readonly />
      <div class="btn-group" id="filaButtonsRxA"></div>
      <div class="btn-group" id="btButtonsRxA"></div>
      <div class="btn-group" id="dgoButtonsRxA"></div>
      <div class="btn-group" id="fibraButtonsRxA"></div>
    </div>
  </div>

  <div class="dupla">
    <div><label for="txPotenciaA">TX: Potência</label><input type="text" id="txPotenciaA" /></div>
    <div><label for="rxPotenciaA">RX: Potência</label><input type="text" id="rxPotenciaA" /></div>
  </div>

  <h3>Afetação</h3>
  <div class="checkboxes">
    <label><input type="checkbox" id="backboneRegional" onclick="toggleCheckbox('backboneRegional', ['backboneNacional'])" /> Regional</label>
    <label><input type="checkbox" id="backboneNacional" onclick="toggleCheckbox('backboneNacional', ['backboneRegional'])" /> Nacional</label>
  </div>

  <div class="checkboxes">
    <label><input type="checkbox" id="causaRompimento" onclick="toggleCheckbox('causaRompimento', ['causaAtenuacao'])" /> Rompimento</label>
    <label><input type="checkbox" id="causaAtenuacao" onclick="toggleCheckbox('causaAtenuacao', ['causaRompimento'])" /> Atenuação</label>
  </div>

  <label for="equipamentoSelect">Nome do equipamento:</label>
  <select id="equipamentoSelect"></select>
  <input type="text" id="novoEquipamento" placeholder="Novo equipamento" />
  <button onclick="adicionarEquipamento()">Adicionar Equipamento</button>

  <label for="numeroCabo">Número do cabo:</label>
  <input type="text" id="numeroCabo" />

  <label for="contato">Contato:</label>
  <input type="text" id="contato" value="48992586783" />

  <label for="obs">OBS:</label>
  <textarea id="obs" rows="3"></textarea>

  <button onclick="gerarCarimbo()">Gerar Carimbo</button>
  <pre id="output"></pre>
</div>

<footer>
  © Desenvolvido por Alexandre Giordan Marafigo
</footer>

<script>
  const chaveTecnicos = 'carimboTecnicos';
  const chaveSitesB = 'carimboSitesPontaB';
  const chaveSitesA = 'carimboSitesPontaA';
  const chaveEquipamentos = 'carimboEquipamentos';

  function carregarLista(chave) {
    const lista = JSON.parse(localStorage.getItem(chave));
    return Array.isArray(lista) ? lista : [];
  }

  function salvarLista(chave, lista) {
    localStorage.setItem(chave, JSON.stringify(lista));
  }

  function popularSelect(id, lista, placeholderText) {
    const select = document.getElementById(id);
    select.innerHTML = '';
    const placeholderOption = document.createElement('option');
    placeholderOption.value = '';
    placeholderOption.textContent = placeholderText;
    placeholderOption.disabled = true;
    placeholderOption.selected = true;
    select.appendChild(placeholderOption);
    lista.forEach(item => {
      const option = document.createElement('option');
      option.value = item;
      option.textContent = item;
      select.appendChild(option);
    });
  }

  function adicionarItem(chave, inputId, selectId, nomeCampo, placeholderText) {
    const input = document.getElementById(inputId);
    const valor = input.value.trim();
    if (!valor) {
      alert(`Digite o nome do ${nomeCampo} para adicionar.`);
      return;
    }
    let lista = carregarLista(chave);
    if (lista.includes(valor)) {
      alert(`${nomeCampo} já está na lista.`);
      input.value = '';
      return;
    }
    lista.push(valor);
    salvarLista(chave, lista);
    popularSelect(selectId, lista, placeholderText);
    document.getElementById(selectId).value = valor;
    input.value = '';
    alert(`${nomeCampo} "${valor}" adicionado.`);
  }

  function adicionarTecnico() {
    adicionarItem(chaveTecnicos, 'novoTecnico', 'tecnicoSelect', 'Técnico', 'Selecione o técnico');
  }
  function adicionarSite() {
    adicionarItem(chaveSitesB, 'novoSite', 'siteSelect', 'Site Ponta B', 'Selecione o site Ponta B');
  }
  function adicionarSiteA() {
    adicionarItem(chaveSitesA, 'novoSiteA', 'siteSelectA', 'Site Ponta A', 'Selecione o site Ponta A');
  }
  function adicionarEquipamento() {
    adicionarItem(chaveEquipamentos, 'novoEquipamento', 'equipamentoSelect', 'Equipamento', 'Selecione o equipamento');
  }

  function toggleCheckbox(idChecked, others) {
    others.forEach(id => {
      if (id !== idChecked) {
        document.getElementById(id).checked = false;
      }
    });
    const cb = document.getElementById(idChecked);
    if (!cb.checked) cb.checked = true;
  }

  // Arrays para os botões
  const filas = ['1','2','3','4','5','6','A','B','C','D','E','F'];
  const btNumbers = ['01','02','03','04','05','06','07','08'];
  const dgoNumbers = Array.from({length:10},(_,i)=> (i+1).toString());
  const fibraNumbers = Array.from({length:36},(_,i)=> {
    let n = i+1;
    return n < 10 ? '0'+n : ''+n;
  });

  // Função para criar botões
  function criarBotoes(containerId, prefixo, valores, ponta, tipo) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    valores.forEach(val => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'btn-small';
      btn.textContent = val;
      btn.onclick = () => adicionarParte(ponta, tipo, prefixo, val);
      container.appendChild(btn);
    });
  }

  // Adiciona parte ao campo ativo (ex: FL1/BT01/DGO1/F01)
  function adicionarParte(ponta, tipo, prefixo, valor) {
    const idCampo = tipo + (ponta === 'B' ? '' : 'A') + 'Fisico';
    let campo = document.getElementById(idCampo);
    if (!campo) return;

    let texto = campo.value.trim();
    let partes = texto ? texto.split('/') : [];

    // índices para manter ordem
    const indices = { FL:0, BT:1, DGO:2, F:3 };
    let idx = indices[prefixo];

    let parteNova = prefixo + valor;

    partes[idx] = parteNova;

    // preencher vazios intermediários para não bagunçar a ordem
    for (let i=0; i<4; i++) {
      if (!partes[i]) partes[i] = '';
    }

    // monta texto final, juntando só os não vazios
    let resultado = partes.filter(p => p !== '').join('/');

    campo.value = resultado;
  }

  // Para marcar qual campo está ativo (TX ou RX, ponta B ou A)
  function ativarCampo(ponta, tipo) {
    if(ponta === 'B') {
      campoAtivoB = tipo + 'Fisico';
    } else {
      campoAtivoA = tipo + 'FisicoA';
    }
  }

  // Define os eventos ao carregar a página
  window.onload = () => {
    popularSelect('tecnicoSelect', carregarLista(chaveTecnicos), 'Selecione o técnico');
    popularSelect('siteSelect', carregarLista(chaveSitesB), 'Selecione o site Ponta B');
    popularSelect('siteSelectA', carregarLista(chaveSitesA), 'Selecione o site Ponta A');
    popularSelect('equipamentoSelect', carregarLista(chaveEquipamentos), 'Selecione o equipamento');

    criarBotoes('filaButtonsB', 'FL', filas, 'B', 'tx');
    criarBotoes('btButtonsB', 'BT', btNumbers, 'B', 'tx');
    criarBotoes('dgoButtonsB', 'DGO', dgoNumbers, 'B', 'tx');
    criarBotoes('fibraButtonsB', 'F', fibraNumbers, 'B', 'tx');

    criarBotoes('filaButtonsRxB', 'FL', filas, 'B', 'rx');
    criarBotoes('btButtonsRxB', 'BT', btNumbers, 'B', 'rx');
    criarBotoes('dgoButtonsRxB', 'DGO', dgoNumbers, 'B', 'rx');
    criarBotoes('fibraButtonsRxB', 'F', fibraNumbers, 'B', 'rx');

    criarBotoes('filaButtonsA', 'FL', filas, 'A', 'tx');
    criarBotoes('btButtonsA', 'BT', btNumbers, 'A', 'tx');
    criarBotoes('dgoButtonsA', 'DGO', dgoNumbers, 'A', 'tx');
    criarBotoes('fibraButtonsA', 'F', fibraNumbers, 'A', 'tx');

    criarBotoes('filaButtonsRxA', 'FL', filas, 'A', 'rx');
    criarBotoes('btButtonsRxA', 'BT', btNumbers, 'A', 'rx');
    criarBotoes('dgoButtonsRxA', 'DGO', dgoNumbers, 'A', 'rx');
    criarBotoes('fibraButtonsRxA', 'F', fibraNumbers, 'A', 'rx');

    // Ativa campo ao focar (para melhor UX)
    ['txFisico','rxFisico','txFisicoA','rxFisicoA'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('focus', () => {
          ativarCampo(
            id.includes('A') ? 'A' : 'B',
            id.startsWith('tx') ? 'tx' : 'rx'
          );
        });
      }
    });

    // Tornar campos TX Física e RX Física editáveis apenas via botões
    ['txFisico','rxFisico','txFisicoA','rxFisicoA'].forEach(id => {
      const el = document.getElementById(id);
      if(el) {
        el.readOnly = true;
      }
    });
  };

  // Função para gerar o carimbo, igual ao seu código anterior
  function gerarCarimbo() {
    const ta = document.getElementById('ta').value.trim();
    const vivo1 = document.getElementById('vivo1').checked ? '( X ) VIVO1' : '( ) VIVO1';
    const vivo2 = document.getElementById('vivo2').checked ? '( X ) VIVO2' : '( ) VIVO2';
    const tecnico = document.getElementById('tecnicoSelect').value.trim();
    const siteB = document.getElementById('siteSelect').value.trim();
    const txFisicoB = document.getElementById('txFisico').value.trim();
    const rxFisicoB = document.getElementById('rxFisico').value.trim();
    const txPotB = document.getElementById('txPotencia').value.trim();
    const rxPotB = document.getElementById('rxPotencia').value.trim();
    const siteA = document.getElementById('siteSelectA').value.trim();
    const txFisicoA = document.getElementById('txFisicoA').value.trim();
    const rxFisicoA = document.getElementById('rxFisicoA').value.trim();
    const txPotA = document.getElementById('txPotenciaA').value.trim();
    const rxPotA = document.getElementById('rxPotenciaA').value.trim();
    const backboneRegional = document.getElementById('backboneRegional').checked ? 'Regional' : '';
    const backboneNacional = document.getElementById('backboneNacional').checked ? 'Nacional' : '';
    const causaRompimento = document.getElementById('causaRompimento').checked ? 'Rompimento' : '';
    const causaAtenuacao = document.getElementById('causaAtenuacao').checked ? 'Atenuação' : '';
    const equipamento = document.getElementById('equipamentoSelect').value.trim();
    const numeroCabo = document.getElementById('numeroCabo').value.trim();
    const contato = document.getElementById('contato').value.trim();
    const obs = document.getElementById('obs').value.trim();

    if (!ta) { alert('Preencha o TA'); return; }
    if (!tecnico) { alert('Selecione o Técnico'); return; }
    if (!siteB) { alert('Selecione o Site Ponta B'); return; }
    if (!siteA) { alert('Selecione o Site Ponta A'); return; }
    if (!equipamento) { alert('Selecione o Equipamento'); return; }

    let carimbo = 
`TA: ${ta}
${vivo1}    ${vivo2}

Técnico: ${tecnico}

Ponta B:
Site: ${siteB}
TX Física: ${txFisicoB}
RX Física: ${rxFisicoB}
TX Potência: ${txPotB}
RX Potência: ${rxPotB}

Ponta A:
Site: ${siteA}
TX Física: ${txFisicoA}
RX Física: ${rxFisicoA}
TX Potência: ${txPotA}
RX Potência: ${rxPotA}

Afetação: ${backboneRegional || backboneNacional}
Causa: ${causaRompimento || causaAtenuacao}

Equipamento: ${equipamento}
Número do cabo: ${numeroCabo}
Contato: ${contato}

OBS:
${obs}`;

    document.getElementById('output').textContent = carimbo;
  }
</script>
</body>
</html>
