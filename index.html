<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carimbo Rede Externa</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    .form-container {
      background: white;
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border: 2px solid #222;
      font-family: 'Courier New', monospace;
    }
    h2, h3 {
      text-align: center;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 8px;
      font-family: monospace;
      margin-top: 5px;
      box-sizing: border-box;
    }
    textarea {
      resize: vertical;
    }
    button {
      margin-top: 10px;
      padding: 10px;
      width: 100%;
      cursor: pointer;
      font-weight: bold;
      background: #222;
      color: white;
      border: none;
    }
    .checkboxes,
    .checkboxes-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    .checkboxes label,
    .checkboxes-inline label {
      font-weight: normal;
      cursor: pointer;
    }
    .dupla {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .dupla > div {
      flex: 1;
    }
    pre {
      margin-top: 20px;
      padding: 15px;
      background: #eee;
      border: 1px solid #ccc;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      line-height: 1.3;
    }
  </style>
</head>
<body>
<div class="form-container">
  <h2>Carimbo Rede Externa</h2>

  <label for="ta">TA:</label>
  <input type="text" id="ta" placeholder="Ex: 344731005" />

  <div class="checkboxes-inline">
    <label><input type="checkbox" id="vivo1" /> VIVO1</label>
    <label><input type="checkbox" id="vivo2" /> VIVO2</label>
  </div>

  <label for="tecnicoSelect">Técnico:</label>
  <select id="tecnicoSelect"></select>
  <input type="text" id="novoTecnico" placeholder="Novo técnico" />
  <button onclick="adicionarTecnico()">Adicionar Técnico</button>

  <h3>Ponta B</h3>
  <label for="siteSelect">Site:</label>
  <select id="siteSelect"></select>
  <input type="text" id="novoSite" placeholder="Novo site Ponta B" />
  <button onclick="adicionarSite()">Adicionar Site Ponta B</button>

  <div class="dupla">
    <div><label for="txFisico">TX:</label><input type="text" id="txFisico" /></div>
    <div><label for="txPotencia">Potência TX:</label><input type="text" id="txPotencia" /></div>
  </div>
  <div class="dupla">
    <div><label for="rxFisico">RX:</label><input type="text" id="rxFisico" /></div>
    <div><label for="rxPotencia">Potência RX:</label><input type="text" id="rxPotencia" /></div>
  </div>

  <h3>Ponta A</h3>
  <label for="siteSelectA">Site:</label>
  <select id="siteSelectA"></select>
  <input type="text" id="novoSiteA" placeholder="Novo site Ponta A" />
  <button onclick="adicionarSiteA()">Adicionar Site Ponta A</button>

  <div class="dupla">
    <div><label for="txFisicoA">TX:</label><input type="text" id="txFisicoA" /></div>
    <div><label for="txPotenciaA">Potência TX:</label><input type="text" id="txPotenciaA" /></div>
  </div>
  <div class="dupla">
    <div><label for="rxFisicoA">RX:</label><input type="text" id="rxFisicoA" /></div>
    <div><label for="rxPotenciaA">Potência RX:</label><input type="text" id="rxPotenciaA" /></div>
  </div>

  <h3>Afetação</h3>
  <div class="checkboxes-inline">
    <label><input type="checkbox" id="backboneRegional" onclick="toggleCheckbox('backboneRegional', ['backboneNacional'])" /> Regional</label>
    <label><input type="checkbox" id="backboneNacional" onclick="toggleCheckbox('backboneNacional', ['backboneRegional'])" /> Nacional</label>
  </div>
  <div class="checkboxes-inline">
    <label><input type="checkbox" id="causaRompimento" onclick="toggleCheckbox('causaRompimento', ['causaAtenuacao'])" /> Rompimento</label>
    <label><input type="checkbox" id="causaAtenuacao" onclick="toggleCheckbox('causaAtenuacao', ['causaRompimento'])" /> Atenuação</label>
  </div>

  <label for="equipamentoSelect">Nome do equipamento:</label>
  <select id="equipamentoSelect"></select>
  <input type="text" id="novoEquipamento" placeholder="Novo equipamento" />
  <button onclick="adicionarEquipamento()">Adicionar Equipamento</button>

  <label for="numeroCabo">Número do cabo:</label>
  <input type="text" id="numeroCabo" />

  <label for="contato">Contato:</label>
  <input type="text" id="contato" value="48992586783" />

  <label for="obs">OBS:</label>
  <textarea id="obs" rows="3"></textarea>

  <button onclick="gerarCarimbo()">Gerar Carimbo</button>
  <pre id="output"></pre>
</div>

<script>
const chaveTecnicos = 'carimboTecnicos';
const chaveSitesB = 'carimboSitesPontaB';
const chaveSitesA = 'carimboSitesPontaA';
const chaveEquipamentos = 'carimboEquipamentos';

function carregarLista(chave) {
  const lista = JSON.parse(localStorage.getItem(chave));
  return Array.isArray(lista) ? lista : [];
}

function salvarLista(chave, lista) {
  localStorage.setItem(chave, JSON.stringify(lista));
}

function popularSelect(id, lista, placeholderText) {
  const select = document.getElementById(id);
  select.innerHTML = '';

  const placeholderOption = document.createElement('option');
  placeholderOption.value = '';
  placeholderOption.textContent = placeholderText;
  placeholderOption.disabled = true;
  placeholderOption.selected = true;
  select.appendChild(placeholderOption);

  lista.forEach(item => {
    const option = document.createElement('option');
    option.value = item;
    option.textContent = item;
    select.appendChild(option);
  });
}

function adicionarItem(chave, inputId, selectId, nomeCampo, placeholderText) {
  const input = document.getElementById(inputId);
  const valor = input.value.trim();
  if (!valor) return;
  let lista = carregarLista(chave);
  if (lista.includes(valor)) {
    input.value = '';
    return;
  }
  lista.push(valor);
  salvarLista(chave, lista);
  popularSelect(selectId, lista, placeholderText);
  document.getElementById(selectId).value = valor;
  input.value = '';
}

function adicionarTecnico() {
  adicionarItem(chaveTecnicos, 'novoTecnico', 'tecnicoSelect', 'Técnico', 'Selecione o técnico');
}
function adicionarSite() {
  adicionarItem(chaveSitesB, 'novoSite', 'siteSelect', 'Site Ponta B', 'Selecione o site Ponta B');
}
function adicionarSiteA() {
  adicionarItem(chaveSitesA, 'novoSiteA', 'siteSelectA', 'Site Ponta A', 'Selecione o site Ponta A');
}
function adicionarEquipamento() {
  adicionarItem(chaveEquipamentos, 'novoEquipamento', 'equipamentoSelect', 'Equipamento', 'Selecione o equipamento');
}

function toggleCheckbox(idChecked, others) {
  others.forEach(id => {
    if (id !== idChecked) document.getElementById(id).checked = false;
  });
  const cb = document.getElementById(idChecked);
  if (!cb.checked) cb.checked = true;
}

function gerarCarimbo() {
  const vivo1 = document.getElementById('vivo1').checked ? '(X )' : '( )';
  const vivo2 = document.getElementById('vivo2').checked ? '(X )' : '( )';
  const backboneRegional = document.getElementById('backboneRegional').checked ? '(X )' : '( )';
  const backboneNacional = document.getElementById('backboneNacional').checked ? '(X )' : '( )';
  const causaRompimento = document.getElementById('causaRompimento').checked ? '(x )' : '( )';
  const causaAtenuacao = document.getElementById('causaAtenuacao').checked ? '(x )' : '( )';

  const texto = `CARIMBO REDE EXTERNA ================================
TA: ${document.getElementById("ta").value}

REDE: ${vivo1} VIVO1 ${vivo2} VIVO2

Ponta B: ${document.getElementById("siteSelect").value}
POSIÇÕES SALA DE TRANSMISSÃO/DGO:
TX: ${document.getElementById("txFisico").value}     TX: ${document.getElementById("txPotencia").value}
RX: ${document.getElementById("rxFisico").value}     RX: ${document.getElementById("rxPotencia").value}

Ponta A: ${document.getElementById("siteSelectA").value}
POSIÇÕES SALA DE TRANSMISSÃO/DGO:
TX: ${document.getElementById("txFisicoA").value}     TX: ${document.getElementById("txPotenciaA").value}
RX: ${document.getElementById("rxFisicoA").value}     RX: ${document.getElementById("rxPotenciaA").value}

Afetação:
Backbone: Regional ${backboneRegional} Nacional ${backboneNacional}
Causa: Rompimento ${causaRompimento} Atenuação ${causaAtenuacao}
Nome do equipamento: ${document.getElementById("equipamentoSelect").value}
Número do cabo: ${document.getElementById("numeroCabo").value}
Técnico: ${document.getElementById("tecnicoSelect").value}
Contato: ${document.getElementById("contato").value}
OBS: ${document.getElementById("obs").value}`;

  document.getElementById("output").textContent = texto;
}

window.onload = () => {
  popularSelect('tecnicoSelect', carregarLista(chaveTecnicos), 'Selecione o técnico');
  popularSelect('siteSelect', carregarLista(chaveSitesB), 'Selecione o site Ponta B');
  popularSelect('siteSelectA', carregarLista(chaveSitesA), 'Selecione o site Ponta A');
  popularSelect('equipamentoSelect', carregarLista(chaveEquipamentos), 'Selecione o equipamento');
};
</script>
</body>
</html>
